---
layout: post
title: React 알아보기7 - 비동기와 React Router
summary: React에서의 비동기프로그래밍과 React Router에 대해서 알아보자
category: React
---
![React Logo](/asset/img/react/React_logo.png){: width="400px" .center-image}
<br>

### 비동기 액션

오늘은 비동기 Application에 대해서 다뤄보도록 하겠습니다. 이번 포스트에서는 Reddit API를 사용해서 선택한 subreddit의 현재 Headline을 보여줄겁니다. 비동기가 어떻게 Redux의 흐름에 적용되게 될까요?

### Action

비동기 API를 호출할 때 매우 __중요한__ 순간이 두 번 있습니다. 호출을 시작할 때와, 응답을 받았을 때(or Timeout)입니다.

* Reducer에게 요청이 시작되었음을 알리는 액션

  리듀서는 이 액션을 처리하기 위해 상태의 `isFetching`표지를 바꾸는 것 같은 일을 할겁니다. 이를 통해 UI가 스피너를 표시해야 한다는 것을 알 수 있습니다.

* Reducer에게 요청이 성공적으로 완료되었다고 알리는 액션

  리듀서는 새 데이터를 상태에 합치고 `isFetching`을 되돌려서 이 액션을 처리할겁니다. UI는 스피너를 숨기고 가져온 데이터를 표시합니다.

* 리듀서에게 요청이 실패했음을 알리는 액션

  리듀서는 `isFetching`을 되돌려서 이 액션을 처리합니다. 리듀서는 에러 메시지를 UI를 표시하기 위해 상태에 저장할수도 있습니다.

우리는 아래와 같이 Action에 따로 `status` 필드를 두고 사용할 수 있습니다.

{% highlight js %}
{ type: 'FETCH_POSTS' }
{ type: 'FETCH_POSTS', status: 'error', error: 'Oops' }
{ type: 'FETCH_POSTS', status: 'success', response: { ... } }
{% endhighlight %}

아니면 아래와 같이 이들만의 타입을 따로 정의할 수도 있습니다.

{% highlight js %}
{ type: 'FETCH_POSTS_REQUEST' }
{ type: 'FETCH_POSTS_FAILURE', error: 'Oops' }
{ type: 'FETCH_POSTS_SUCCESS', response: { ... } }
{% endhighlight %}

하나의 액션 타입에 표지를 두고 사용하건, 여러 액션 타입을 사용하건 여러분에게 달렸습니다. 여러분이 팀과 함께 정할 규칙일 뿐입니다. 여러 타입을 쓰면 실수는 줄겠지만, 여러분이 [redux-actions](https://github.com/acdlite/redux-actions)와 같은 헬퍼 라이브러리를 써서 액션 생산자와 리듀서를 만든다면 이게 별 문제가 되지 않을 수도 있습니다.


둘 중 어떤 규칙을 택하건 이를 Application 내내 유지해야합니다.

### 동기 액션 생산자

우리의 앱에서 필요한 몇 가지 동기 액션 타입과 `Action Creator`를 정의하면서 시작해봅시다.

* 사용자는 표시할 reddit을 선택할 수 있습니다.

{% highlight js %}
export const SELECT_REDDIT = 'SELECT_REDDIT';

export function selectReddit(reddit){
  return {
    type: SELECT_REDDIT,
    reddit
  }
}
{% endhighlight %}



* 참고 1 <http://dobbit.github.io/redux/advanced/AsyncActions.html>
